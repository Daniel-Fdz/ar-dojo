<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <title>Quiz Judo AR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <!-- Sistema de confeti alternativo más impresionante -->
    <script>
        AFRAME.registerComponent('epic-confetti', {
            schema: {
                enabled: { type: 'boolean', default: false }
            },
            init: function () {
                this.particles = [];
                this.createParticles();
            },
            createParticles: function () {
                // Crear 150 partículas más grandes y coloridas
                for (let i = 0; i < 150; i++) {
                    const shapes = ['a-box', 'a-sphere', 'a-cylinder'];
                    const randomShape = shapes[Math.floor(Math.random() * shapes.length)];
                    const particle = document.createElement(randomShape);

                    // Tamaños más grandes
                    if (randomShape === 'a-box') {
                        particle.setAttribute('width', '0.05');
                        particle.setAttribute('height', '0.05');
                        particle.setAttribute('depth', '0.05');
                    } else if (randomShape === 'a-sphere') {
                        particle.setAttribute('radius', '0.03');
                    } else {
                        particle.setAttribute('radius', '0.02');
                        particle.setAttribute('height', '0.06');
                    }

                    // Colores más vibrantes
                    const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8', '#F7DC6F'];
                    particle.setAttribute('material', {
                        color: colors[Math.floor(Math.random() * colors.length)],
                        metalness: 0.3,
                        roughness: 0.4
                    });

                    // Posiciones iniciales más dispersas
                    particle.setAttribute('position', {
                        x: (Math.random() - 0.5) * 3,
                        y: Math.random() * 3 + 1,
                        z: (Math.random() - 0.5) * 3
                    });

                    this.el.appendChild(particle);
                    this.particles.push(particle);
                }
            },
            update: function () {
                this.el.setAttribute('visible', this.data.enabled);
                if (this.data.enabled) {
                    // Animaciones más espectaculares
                    this.particles.forEach((particle, index) => {
                        particle.removeAttribute('animation');
                        particle.removeAttribute('animation__rotation');
                        particle.removeAttribute('animation__scale');

                        setTimeout(() => {
                            // Animación de caída más dramática
                            particle.setAttribute('animation', {
                                property: 'position',
                                to: {
                                    x: (Math.random() - 0.5) * 6,
                                    y: -2,
                                    z: (Math.random() - 0.5) * 6
                                },
                                dur: 4000,
                                easing: 'easeOutBounce'
                            });

                            // Rotación múltiple
                            particle.setAttribute('animation__rotation', {
                                property: 'rotation',
                                to: {
                                    x: Math.random() * 720,
                                    y: Math.random() * 720,
                                    z: Math.random() * 720
                                },
                                dur: 4000,
                                loop: true
                            });
                        }, 100);
                    });
                }
            }
        });
    </script>

    <script src="main.js"></script>
</head>

<body style="margin: 0; overflow: hidden;">
    <!-- Configuración mejorada para móvil -->
    <a-scene embedded
        arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">

        <a-assets>
            <!-- Video de prueba compatible con móviles -->
            <video id="judoVid" src="assets/judo-video.mp4" preload="auto" loop="true" crossorigin="anonymous"
                playsinline>
            </video>
        </a-assets>

        <!-- Marcador personalizado con tracking mejorado -->
        <a-marker type="pattern" url="assets/dojo-marker.patt" smooth="true" smoothCount="10" smoothTolerance="0.01"
            smoothThreshold="5">

            <!-- Vídeo centrado más arriba -->
            <a-video id="video-plane" src="#judoVid" width="1.5" height="0.85" position="0 0 -0.1" rotation="-90 0 0">
            </a-video>

            <!-- Texto de pregunta arriba de todo -->
            <a-text value="&#191;Qu&#233; t&#233;cnica es esta?" align="center" position="0 0 -0.5" width="2.5"
                color="#FFFF00" rotation="-90 0 0" shader="sdf">
            </a-text>

            <!-- Botones más pequeños y arriba del video -->
            <a-plane id="opt1" class="answer" position="-0.8 0 0.3" width="0.4" height="0.2" rotation="-90 0 0"
                material="color: #42A5F5; transparent: true; opacity: 0.9"
                animation__mouseenter="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                animation__mouseleave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
                <a-text value="Ippon-seoi-nage" align="center" position="0 0 0.05" width="1.2" color="#FFFFFF">
                </a-text>
            </a-plane>

            <a-plane id="opt2" class="answer" position="0 0 0.3" width="0.4" height="0.2" rotation="-90 0 0"
                material="color: #42A5F5; transparent: true; opacity: 0.9"
                animation__mouseenter="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                animation__mouseleave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
                <a-text value="Ko-uchi-gari" align="center" position="0 0 0.05" width="1.2" color="#FFFFFF">
                </a-text>
            </a-plane>

            <a-plane id="opt3" class="answer" position="0.8 0 0.3" width="0.4" height="0.2" rotation="-90 0 0"
                material="color: #42A5F5; transparent: true; opacity: 0.9"
                animation__mouseenter="property: scale; to: 1.1 1.1 1.1; startEvents: mouseenter; dur: 200"
                animation__mouseleave="property: scale; to: 1 1 1; startEvents: mouseleave; dur: 200">
                <a-text value="O-uchi-gari" align="center" position="0 0 0.05" width="1.2" color="#FFFFFF">
                </a-text>
            </a-plane>

            <!-- Cruz roja centrada -->
            <a-entity id="cross" position="0 0.8 1.2" rotation="-90 0 0" visible="false">
                <a-box width="0.15" height="0.6" depth="0.05" material="color: #FF4444" position="0 0 0">
                </a-box>
                <a-box width="0.6" height="0.15" depth="0.05" material="color: #FF4444" position="0 0 0">
                </a-box>
                <a-circle radius="0.4" material="color: #FFFFFF; transparent: true; opacity: 0.9" position="0 0 -0.1">
                </a-circle>
            </a-entity>

            <!-- Texto "CORRECTO" para respuesta correcta -->
            <a-text id="correct-text" value="¡CORRECTO!" align="center" position="0 0 0.8" width="4" color="#00FF00"
                rotation="-90 0 0" shader="sdf" visible="false"
                animation__pulse="property: scale; to: 1.2 1.2 1.2; dur: 800; direction: alternate; loop: true; easing: easeInOutSine">
            </a-text>

            <!-- Texto "INCORRECTO" para respuesta incorrecta -->
            <a-text id="incorrect-text" value="INCORRECTO" align="center" position="0 0 0.8" width="3" color="#FF0000"
                rotation="-90 0 0" shader="sdf" visible="false"
                animation__shake="property: rotation; to: -90 5 0; dur: 100; direction: alternate; loop: 6; easing: easeInOutSine">
            </a-text>

            <!-- Confeti épico mejorado -->
            <a-entity id="confetti" epic-confetti="enabled: false" position="0 0.8 1" visible="false">
            </a-entity>

        </a-marker>

        <!-- Cámara sin controles que interfieran -->
        <a-entity camera></a-entity>

        <!-- Cursor optimizado para móvil -->
        <a-entity id="mouseCursor" cursor="rayOrigin: mouse; fuse: false"
            raycaster="objects: .answer; recursive: false">
        </a-entity>

    </a-scene>
</body>

</html>
